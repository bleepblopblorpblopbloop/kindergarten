<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>{{title}}</title>
  <link rel="stylesheet" href="/stylesheets/style.css" />
  <script src='https://api.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.css' rel='stylesheet' />
  <script
    src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.2.0/mapbox-gl-geocoder.min.js'></script>
  <link rel='stylesheet'
    href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.2.0/mapbox-gl-geocoder.css'
    type='text/css' />
  <script <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>

<body>


  <h1>Find your Kita</h1>

  </div>

  <div id='map'></div>

  <script>

    mapboxgl.accessToken = 'pk.eyJ1IjoidG9za2FtYWxpc2tlIiwiYSI6ImNrMnp5YzFhdTBra3czZ3A4OWRlYjljM28ifQ.ezvu3fb-mf_LzX6zcKGTVg';
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [13.40, 52.52],
      zoom: 14
    });

    var geocoder = new MapboxGeocoder({ // Initialize the geocoder
      accessToken: mapboxgl.accessToken, // Set the access token
      mapboxgl: mapboxgl, // Set the mapbox-gl instance
      marker: false, // Do not use the default marker style
      placeholder: 'Search for Kitas in Berlin'
    });

    // Add the geocoder to the map
    map.addControl(geocoder);

    geocoder.on('result', () => {

      const getMarkers = () => {
        axios.get('/api/kitas').then(response => {
          //console.log('map', response)
          response.data.forEach(point => {
            console.log(point);
            const coordinates = [point.long, point.lat];
            new mapboxgl.Marker().setLngLat(coordinates).addTo(map)

          })
        })
      }

      getMarkers()
    });

  </script>

</body>

</html>